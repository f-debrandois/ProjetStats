---
title: "Projet d'étude de Statistiques"
author: "Maxime Baba, Alexandre Demarquet, Félix de Brandois, Tristan Gay"
institute : "INSA Toulouse / ENSEEIHT"
date: "`r Sys.Date()`"
output: 
  pdf_document :
    toc : TRUE
    toc_depth : 2
    number_section : TRUE
header-includes:
   - \usepackage{dsfont}
   - \usepackage{color}
   - \newcommand{\1}{\mathds{1}}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(reticulate)
library(ggplot2)
library(corrplot)
library(FactoMineR)
library(factoextra)
library(gridExtra)
```




# Introduction
Le but de ce projet est d'étudier différents polluants mesurés par de nombreux EPCI d'Occitanie.\
Nous disposons du jeu de données suivant :
```{r}
data <- read.csv("Data-projetmodIA-2324.csv")
```

```{r}
summary(data)
data[1,]
```

- Notations :\


# Analyse descriptive des données
Dans un premier temps on extrait les données du fichier Data-projetmodIA-2324.csv. Puis on extrait les données quantitatives de ce jeu de données (les quantités de gaz). Puis on visualise globalement les données quantitatives brutes.
```{r,echo=T}
data_quant=data[,c("nox_kg","so2_kg","pm10_kg","pm25_kg","co_kg","c6h6_kg","nh3_kg","ges_teqco2","ch4_t","co2_t","n2o_t")]
data_quant=as.data.frame(data_quant)
head(data_quant)
```

```{r,echo=TRUE,eval=TRUE,fig.cap="Boxplot des variables nox_kg,co_kg,so2_kg",fig.height=2}
g1=ggplot(data_quant)+geom_boxplot(aes(y = nox_kg))
g2=ggplot(data_quant)+geom_boxplot(aes(y = co_kg))
g3=ggplot(data_quant)+geom_boxplot(aes(y =so2_kg ))
grid.arrange(g1,g2,g3,ncol=3)
```

```{r,echo=TRUE,eval=TRUE,fig.cap="Histogramme de la variable co_kg en brute, scale et scale(log())",fig.height=4}
g1=ggplot(data_quant)+ geom_histogram(aes(x = (co_kg)),bins =20 )
g2=ggplot(data_quant)+ geom_histogram(aes(x = scale(co_kg)),bins =20)
g3=ggplot(data_quant)+ geom_histogram(aes(x = scale(log(co_kg))),bins =20)
grid.arrange(g1,g2,g3,ncol=3)
```

```{r,eval=FALSE,echo=FALSE}
#données brutes
g1= ggplot(data = data) + geom_histogram(aes(x = (nox_kg)))
g2= ggplot(data = data) + geom_histogram(aes(x = (so2_kg)))
g3= ggplot(data = data) + geom_histogram(aes(x = (pm10_kg)))
g4= ggplot(data = data) + geom_histogram(aes(x = (pm25_kg)))
g5= ggplot(data = data) + geom_histogram(aes(x = (co_kg)))
g6= ggplot(data = data) + geom_histogram(aes(x = (c6h6_kg)))
g7= ggplot(data = data) + geom_histogram(aes(x = (ges_teqco2)))
g8= ggplot(data = data) + geom_histogram(aes(x = (ch4_t)))
g9= ggplot(data = data) + geom_histogram(aes(x = (co2_t)))
g10= ggplot(data = data) + geom_histogram(aes(x = (n2o_t)))
g11= ggplot(data = data) + geom_histogram(aes(x = (nh3_kg)))
grid.arrange(g1, g2, g3, g4, g5, g6, g11, g7, g8, g9, g10, ncol = 3)
```

```{r,eval=FALSE,echo=FALSE}
#Avec Scale
g1= ggplot(data = data) + geom_histogram(aes(x = scale(nox_kg)))
g2= ggplot(data = data) + geom_histogram(aes(x = scale(so2_kg)))
g3= ggplot(data = data) + geom_histogram(aes(x = scale(pm10_kg)))
g4= ggplot(data = data) + geom_histogram(aes(x = scale(pm25_kg)))
g5= ggplot(data = data) + geom_histogram(aes(x = scale(co_kg)))
g6= ggplot(data = data) + geom_histogram(aes(x = scale(c6h6_kg)))
g7= ggplot(data = data) + geom_histogram(aes(x = scale(ges_teqco2)))
g8= ggplot(data = data) + geom_histogram(aes(x = scale(ch4_t)))
g9= ggplot(data = data) + geom_histogram(aes(x = scale(co2_t)))
g10= ggplot(data = data) + geom_histogram(aes(x = scale(n2o_t)))
g11= ggplot(data = data) + geom_histogram(aes(x = scale(nh3_kg)))
grid.arrange(g1, g2, g3, g4, g5, g6, g11, g7, g8, g9, g10, ncol = 3)
```

```{r,eval=FALSE,echo=FALSE}
#Avec scale(log)
g1= ggplot(data = data) + geom_histogram(aes(x = scale(log(nox_kg))))
g2= ggplot(data = data) + geom_histogram(aes(x = scale(log(so2_kg))))
g3= ggplot(data = data) + geom_histogram(aes(x = scale(log(pm10_kg))))
g4= ggplot(data = data) + geom_histogram(aes(x = scale(log(pm25_kg))))
g5= ggplot(data = data) + geom_histogram(aes(x = scale(log(co_kg))))
g6= ggplot(data = data) + geom_histogram(aes(x = scale(log(c6h6_kg))))
g7= ggplot(data = data) + geom_histogram(aes(x = scale(log(ges_teqco2))))
g8= ggplot(data = data) + geom_histogram(aes(x = scale(log(ch4_t))))
g9= ggplot(data = data) + geom_histogram(aes(x = scale(log(co2_t))))
g10= ggplot(data = data) + geom_histogram(aes(x = scale(log(n2o_t))))
g11= ggplot(data = data) + geom_histogram(aes(x = scale(log(nh3_kg))))
grid.arrange(g1, g2, g3, g4, g5, g6, g11, g7, g8, g9, g10, ncol = 3)
```



On effectue une transformation des données car d'après les boxplots de la figure ?? on remarque une variance énorme de certaines données comme co_kg. En examinant l'histogramme des données quantitatives, on observe une distribution fortement asymétrique. On peut donc appliquer une log-transformation pour normaliser la distribution des données. Certaines variables ont pour unité la tonne et d'autre le kg on peut donc scale les données. On peut visualiser l'interet de ces transformations grâce à la figure ?? avec la varibale co_kg.
Par la suite on scale log les données de la manière suivante.
```{r,echo=T,eval=TRUE}
data_quant_scaled <- scale(log(data_quant))
data_scaled_df <- as.data.frame(data_quant_scaled)
```


```{r,echo=TRUE,eval=TRUE,fig.cap="Corrélation entre les variables",fig.height=4}
mat_cor <- cor(data_scaled_df)
corrplot(mat_cor,method="ellipse")
```
La visualisation de la figure ?? nous permet d'identifier rapidement les relations significatives entre nos variables. Les ellipses fortement allongées suggèrent une corrélation plus forte, tandis que les ellipses plus circulaires indiquent une corrélation plus faible. 

## Statistiques decriptive des données qualitatives

Dans le jeu de données nous avons aussi des variables qualitatives comme le code epci, le lib_epci ou des infos sur les départements.

```{r,eval=T,echo=T}
data_quali=data[,c("code_epci","lib_epci","annee_inv","TypeEPCI","nomdepart")]
table(data_quali[,c("nomdepart")])
```

```{r,eval=T,echo=T}
ggplot(data=data_quali)+geom_bar(aes(x = TypeEPCI))
```


## Analyse des données

### PCA
On visualise les individue à partir des émissions de polluants.\




### Réduction de dimension (MCA)


# Classification des EPCI
## Clustering

## Analyse discriminante linéaire


# EMS

## Modèle linéaire

### Modèle d'ANOVA
On explique le gaz à effet de serre en fonction des variables Type et années.\

On utilise un modèle d'ANOVA à deux facteurs avec interaction :
$$
Y_{ij} = \mu + \alpha_{i} + \beta_{j} + \gamma_{ij} + \epsilon_{ij}
$$

```{r}
dlog=data[4:15]
data_quant=scale(log(data[4:14]))
dlog[1:11]=data_quant
dlog=data.frame(dlog,annee_inv=data$annee_inv)

anov2= lm(ges_teqco2 ~TypeEPCI * annee_inv, data=dlog)
summary(anov2)
```

-> Commentaire sur la valeur de R² obtenue.\

On essaie de simplifier le modèle en enlevant les interactions.

```{r}
anov_sans_int=lm(ges_teqco2 ~TypeEPCI + annee_inv, data=dlog)
anova(anov_sans_int,anov2)
```

On obtient une p-value de `r round(anova(anov_sans_int,anov2)$Pr[2], digits=2)` > $0.05$.\
On peut donc enlever les interactions :
$$
Y_{ij} = \mu + \alpha_{i} + \beta_{j} + \epsilon_{ij}
$$

On essaie de simplifier le modèle en enlevant les variables non significatives.

```{r}
anov_annee=lm(ges_teqco2 ~annee_inv, data=dlog)
anov_type=lm(ges_teqco2 ~TypeEPCI, data=dlog)

anova(anov_annee,anov_sans_int)
anova(anov_type,anov_sans_int)
```

Pour le modèle dépendant uniquement du type d'EPCI, on obtient une p-value de `r round(anova(anov_type,anov_sans_int)$Pr[2], digits=2)` > $0.05$.\
On peut donc enlever l'année dans le modèle :
$$
Y_{ij} = \mu + \alpha_{i} + \epsilon_{ij}
$$

On essaie à nouveau de simplifier le modèle en enlevant les variables non significatives.

```{r}
anova(lm(ges_teqco2 ~1, data=dlog),anov_type)
```

On obtient cette fois une p-value de `r round(anova(lm(ges_teqco2 ~1, data=dlog),anov_type)$Pr[2], digits=2)` < $0.05$.\
On ne peut donc pas enlever le type d'EPCI dans le modèle.

On vérifie finalement la cohérence du modèle retenu :
```{r}
anova(anov_type,anov2)
```

On obtient une p-value de `r round(anova(anov_type,anov2)$Pr[2], digits = 2)
` > $0.05$ donc le modèle est cohérent.
On garde donc le modèle :

```{r}
summary(anov_type)
```



### Régression linéaire

### ANCOVA

## Modèle linéaire généralisé


# Conclusion
