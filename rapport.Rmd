---
title: "Rapport du projet"
author: "Tristan Gay,Maxime Baba, Félix de Brandois et Alexandre Demarquet"
institute : "INSA Toulouse / IMT"
date: "`r Sys.Date()`"
#bibliography: "exbiblio.bib"
output: 
  pdf_document :
    toc : TRUE
    toc_depth : 2
    number_section : TRUE
header-includes:
   - \usepackage{dsfont}
   - \usepackage{color}
   - \newcommand{\1}{\mathds{1}}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(reticulate)
library(ggplot2)
library(corrplot)
library(FactoMineR)
library(factoextra)
library(gridExtra)
```

\vspace{1cm}


# Introduction
 Notations
 
 
# Analyse descriptive

## Statistiques decriptives des données quantitatives
Dans un premier temps on extrait les données du fichier Data-projetmodIA-2324.csv. Puis on extrait les données quantitatives de ce jeu de données (les quantités de gaz). Puis on visualise globalement les données quantitatives brutes.
```{r,echo=T}
Data<-read.csv('Data-projetmodIA-2324.csv')
data_quant=Data[,c("nox_kg","so2_kg","pm10_kg","pm25_kg","co_kg","c6h6_kg","nh3_kg","ges_teqco2","ch4_t","co2_t","n2o_t")]
data_quant=as.data.frame(data_quant)
head(data_quant)
```

```{r,echo=TRUE,eval=TRUE,fig.cap="Boxplot des variables nox_kg,co_kg,so2_kg",fig.height=2}
g1=ggplot(data_quant)+geom_boxplot(aes(y = nox_kg))
g2=ggplot(data_quant)+geom_boxplot(aes(y = co_kg))
g3=ggplot(data_quant)+geom_boxplot(aes(y =so2_kg ))
grid.arrange(g1,g2,g3,ncol=3)
```

```{r,echo=TRUE,eval=TRUE,fig.cap="Histogramme de la variable co_kg en brute, scale et scale(log())",fig.height=4}
g1=ggplot(data_quant)+ geom_histogram(aes(x = (co_kg)),bins =20 )
g2=ggplot(data_quant)+ geom_histogram(aes(x = scale(co_kg)),bins =20)
g3=ggplot(data_quant)+ geom_histogram(aes(x = scale(log(co_kg))),bins =20)
grid.arrange(g1,g2,g3,ncol=3)
```

```{r,eval=FALSE,echo=FALSE}
#données brutes
g1= ggplot(data = Data) + geom_histogram(aes(x = (nox_kg)))
g2= ggplot(data = Data) + geom_histogram(aes(x = (so2_kg)))
g3= ggplot(data = Data) + geom_histogram(aes(x = (pm10_kg)))
g4= ggplot(data = Data) + geom_histogram(aes(x = (pm25_kg)))
g5= ggplot(data = Data) + geom_histogram(aes(x = (co_kg)))
g6= ggplot(data = Data) + geom_histogram(aes(x = (c6h6_kg)))
g7= ggplot(data = Data) + geom_histogram(aes(x = (ges_teqco2)))
g8= ggplot(data = Data) + geom_histogram(aes(x = (ch4_t)))
g9= ggplot(data = Data) + geom_histogram(aes(x = (co2_t)))
g10= ggplot(data = Data) + geom_histogram(aes(x = (n2o_t)))
g11= ggplot(data = Data) + geom_histogram(aes(x = (nh3_kg)))
grid.arrange(g1, g2, g3, g4, g5, g6, g11, g7, g8, g9, g10, ncol = 3)
```

```{r,eval=FALSE,echo=FALSE}
#Avec Scale
g1= ggplot(data = Data) + geom_histogram(aes(x = scale(nox_kg)))
g2= ggplot(data = Data) + geom_histogram(aes(x = scale(so2_kg)))
g3= ggplot(data = Data) + geom_histogram(aes(x = scale(pm10_kg)))
g4= ggplot(data = Data) + geom_histogram(aes(x = scale(pm25_kg)))
g5= ggplot(data = Data) + geom_histogram(aes(x = scale(co_kg)))
g6= ggplot(data = Data) + geom_histogram(aes(x = scale(c6h6_kg)))
g7= ggplot(data = Data) + geom_histogram(aes(x = scale(ges_teqco2)))
g8= ggplot(data = Data) + geom_histogram(aes(x = scale(ch4_t)))
g9= ggplot(data = Data) + geom_histogram(aes(x = scale(co2_t)))
g10= ggplot(data = Data) + geom_histogram(aes(x = scale(n2o_t)))
g11= ggplot(data = Data) + geom_histogram(aes(x = scale(nh3_kg)))
grid.arrange(g1, g2, g3, g4, g5, g6, g11, g7, g8, g9, g10, ncol = 3)
```

```{r,eval=FALSE,echo=FALSE}
#Avec scale(log)
g1= ggplot(data = Data) + geom_histogram(aes(x = scale(log(nox_kg))))
g2= ggplot(data = Data) + geom_histogram(aes(x = scale(log(so2_kg))))
g3= ggplot(data = Data) + geom_histogram(aes(x = scale(log(pm10_kg))))
g4= ggplot(data = Data) + geom_histogram(aes(x = scale(log(pm25_kg))))
g5= ggplot(data = Data) + geom_histogram(aes(x = scale(log(co_kg))))
g6= ggplot(data = Data) + geom_histogram(aes(x = scale(log(c6h6_kg))))
g7= ggplot(data = Data) + geom_histogram(aes(x = scale(log(ges_teqco2))))
g8= ggplot(data = Data) + geom_histogram(aes(x = scale(log(ch4_t))))
g9= ggplot(data = Data) + geom_histogram(aes(x = scale(log(co2_t))))
g10= ggplot(data = Data) + geom_histogram(aes(x = scale(log(n2o_t))))
g11= ggplot(data = Data) + geom_histogram(aes(x = scale(log(nh3_kg))))
grid.arrange(g1, g2, g3, g4, g5, g6, g11, g7, g8, g9, g10, ncol = 3)
```



On effectue une transformation des données car d'après les boxplots de la figure ?? on remarque une variance énorme de certaines données comme co_kg. En examinant l'histogramme des données quantitatives, on observe une distribution fortement asymétrique. On peut donc appliquer une log-transformation pour normaliser la distribution des données. Certaines variables ont pour unité la tonne et d'autre le kg on peut donc scale les données. On peut visualiser l'interet de ces transformations grâce à la figure ?? avec la varibale co_kg.
Par la suite on scale log les données de la manière suivante.
```{r,echo=T,eval=TRUE}
data_quant_scaled <- scale(log(data_quant))
data_scaled_df <- as.data.frame(data_quant_scaled)
```


```{r,echo=TRUE,eval=TRUE,fig.cap="Corrélation entre les variables",fig.height=4}
mat_cor <- cor(data_scaled_df)
corrplot(mat_cor,method="ellipse")
```
La visualisation de la figure ?? nous permet d'identifier rapidement les relations significatives entre nos variables. Les ellipses fortement allongées suggèrent une corrélation plus forte, tandis que les ellipses plus circulaires indiquent une corrélation plus faible. 

## Statistiques decriptive des données qualitatives

Dans le jeu de données nous avons aussi des variables qualitatives comme le code epci, le lib_epci ou des infos sur les départements.

```{r,eval=T,echo=T}
data_quali=Data[,c("code_epci","lib_epci","annee_inv","TypeEPCI","nomdepart")]
table(data_quali[,c("nomdepart")])
```

```{r,eval=T,echo=T}
ggplot(data=data_quali)+geom_bar(aes(x = TypeEPCI))
```



# Etude du jeu de données Iris

*On va ici utiliser le célèbre jeu de données des Iris pour  illustrer quelques points de rédaction en Rmarkdown. Vous êtes donc invités à parcourir en même temps le .pdf et le .Rmd pour comprendre les points de syntaxe.* 


## Récupération des données 

Les données Iris ont été collectées par Edgar Anderson [@iris]. Ce sont les mesures en centimètres des variables suivantes : longueur du sépale (Sepal.Length), largeur du sépale (Sepal.Width), longueur du pétale (Petal.Length) et largeur du pétale (Petal.Width) pour trois espèces d'iris :*Iris setosa*, *I. versicolor* et *I. virginica*. Les données sont disponibles de base sous R et on les récupère donc avec la fonction `data(iris)`. On affiche ici les premières lignes du jeu de données :

```{r, echo=F}
data(iris)
head(iris)
```

On retrouve bien que les données sont composées de `r nrow(iris)` individus, de 4 variables quantitatives et d'une variable qualitative *Species*. Dans la suite, nous notons $Y$ la variable *Species* et $X$ la matrice composées des 4 autres variables
$$
X=\left(X_{ij}\right),\ i\in\{1,\ldots,150\},\ j\in\{1,\ldots,4\}.
$$

On peut facilement repasser les données en python à l'aide de la librairie `reticulate` et les commandes suivantes : 

```{python, echo=F}
#import numpy as np
#import pandas as pd
#irispy = r.iris
#irispy.head()
```


## Statistiques descriptives

Nous faisons ici quelques statistiques descriptives pour prendre en main les données. 

### La variable *Species*

Nous commençons par la variable *Species* (vecteur $Y$) qui est une variable qualitative. La figure suivante nous permet de contrôler que nous avons bien $50$ individus par espèce. 

```{r species,echo=F,fig.cap="Barplot de la variable Species.",fig.height=2}
ggplot(iris,aes(x=Species))+
  geom_bar()
```

### Les 4 variables quantitatives

Nous nous intéressons ici aux 4 variables quantitatives (matrice $X$). La figure suivante  montre les corrélations entre les 4 variables. On peut remarquer que la largeur et la longuer des pétales sont fortement corrélées positivement, ce n'est pas le cas pour les sépales. 

```{r, echo=F,fig.cap="Matrice des corrélations entre les 4 variables quantitatives",fig.height=3}
corrplot(cor(iris[,-5]), method="ellipse")
```

A l'aide de la librairie `FactoMineR`, on met en place une ACP. On représente ici les individus projetés sur le premier plan factoriel, la couleur correspondant à l'espèce ainsi que les corrélations des variables quantitatives initiales avec les deux premières composantes principales. 


```{r, fig.height=3}
respca=PCA(iris,quali.sup=5,graph=F)
g1=fviz_pca_ind(respca,label="none",habillage=5)+ theme(legend.position="bottom")
g2=fviz_pca_var(respca) 
grid.arrange(g1,g2,ncol=2)
```

On peut remarquer que les *Setosa* se distinguent des deux autres espèces principalement par la largeur de leur sépales. On peut appuyer ce point à l'aide de la figure suivante

```{r,echo=F,fig.height=3,message=F}
ggplot(iris,aes(x=Species,y=Sepal.Width)) +
  geom_violin() +
  geom_dotplot(binaxis='y', stackdir='center', dotsize=0.5)
```

# Reference


